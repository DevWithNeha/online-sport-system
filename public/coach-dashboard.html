<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>OSN â€“ Coach Dashboard</title>
<style>
body{margin:0;font-family:"Segoe UI",Arial;background:#f4f7fa;display:flex}
/* SIDEBAR */
.sidebar{width:230px;height:100vh;background:#1e293b;color:white;position:fixed;top:0;left:0;padding:20px 0}
.sidebar h2{text-align:center;margin-bottom:20px}
.sidebar a{display:block;padding:12px 20px;color:#cbd5e1;text-decoration:none}
.sidebar a:hover{background:#0f172a;color:white}

/* MAIN */
.main{margin-left:230px;padding:22px;width:100%}
.topbar{background:white;padding:16px;border-radius:10px;font-size:22px;font-weight:600;box-shadow:0 4px 20px rgba(0,0,0,0.08);margin-bottom:20px}

/* CARDS */
.cards{display:grid;grid-template-columns:repeat(3,1fr);gap:20px}
.card{background:white;padding:20px;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.08)}
.card h3{margin:0;color:#0f172a;font-weight:600}
.card .num{font-size:30px;font-weight:700;margin-top:10px}

/* LIST */
.list{margin-top:20px;background:white;padding:20px;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.08)}
.item{padding:12px 0;border-bottom:1px solid #eee}
.item:last-child{border-bottom:none}
.small{color:#64748b;font-size:14px;}
</style>
</head>
<body>

<div class="sidebar">
  <h2>OSN Coach</h2>
  <a href="coach-dashboard.html">ğŸ  Dashboard</a>
  <a href="coach-team.html">ğŸ‘¥ Team</a>
  <a href="coach-training.html">ğŸ’ª Training</a>
  <a href="coach-matches.html">ğŸ† Matches</a>
  <a href="coach-analytics.html">ğŸ“Š Analytics</a>
  <a href="coach-profile.html">ğŸ™ Profile</a>
  <a href="#" onclick="logout()">ğŸšª Logout</a>
</div>

<div class="main">
  <div class="topbar" id="welcome">Welcome Coach</div>

  <div class="cards">
      <div class="card">
          <h3>My Teams</h3>
          <div class="num" id="myTeams">â€”</div>
      </div>
      <div class="card">
          <h3>Total Players</h3>
          <div class="num" id="totalPlayers">â€”</div>
      </div>
      <div class="card">
          <h3>Upcoming Matches</h3>
          <div class="num" id="upMatches">â€”</div>
      </div>
  </div>

  <div class="list">
      <h3>Team Overview</h3>
      <div id="teamList">Loading teams...</div>
  </div>

  <div class="list">
      <h3>Upcoming Trainings</h3>
      <div id="trainingList">Loading training...</div>
  </div>
</div>

<script>
const token = localStorage.getItem("osn_token");
const coach = JSON.parse(localStorage.getItem("osn_user") || "{}");

if(!token || coach.role !== "coach"){
    window.location.href="../index.html";
}

document.getElementById("welcome").innerText = "Welcome, " + coach.name;

async function loadCoachDashboard(){
    // Teams & Players
    let r1 = await fetch("/api/coach/teams/" + coach.id);
    let teams = await r1.json();
    document.getElementById("myTeams").innerText = teams.length;
    let totalPlayers = teams.reduce((sum,t)=> sum + (t.members? t.members.length:0),0);
    document.getElementById("totalPlayers").innerText = totalPlayers;

    // Upcoming Matches
    let r2 = await fetch("/api/coach/upcoming/" + coach.id);
    let matches = await r2.json();
    document.getElementById("upMatches").innerText = matches.length;

    // Team Overview
    document.getElementById("teamList").innerHTML = teams.map(t=>`
        <div class="item"><b>${t.name}</b> â€” Players: ${t.members? t.members.length:0}</div>
    `).join("") || "No teams yet.";

    // Trainings
    let r3 = await fetch("/api/coach/training/" + coach.id);
    let training = await r3.json();
    document.getElementById("trainingList").innerHTML = training.map(tr=>`
        <div class="item">${tr.date} â€” ${tr.activity}</div>
    `).join("") || "No training scheduled.";
}

loadCoachDashboard();

function logout(){
    localStorage.removeItem("osn_token");
    localStorage.removeItem("osn_user");
    window.location.href="../index.html";
}
</script>

</body>
</html>
