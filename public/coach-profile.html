<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>OSN ‚Äì Coach Profile</title>
<style>
body{margin:0;font-family:"Segoe UI",Arial;background:#f3f6fa;display:flex}

/* SIDEBAR */
.sidebar{width:230px;height:100vh;background:#1e293b;color:white;position:fixed;top:0;left:0;padding:20px 0}
.sidebar h2{text-align:center;margin-bottom:20px}
.sidebar a{display:block;padding:12px 20px;color:#cbd5e1;text-decoration:none}
.sidebar a:hover{background:#0f172a;color:white}

/* MAIN */
.main{margin-left:230px;padding:22px;width:100%}
.topbar{background:white;padding:16px;border-radius:10px;font-size:22px;font-weight:600;box-shadow:0 4px 20px rgba(0,0,0,0.08);margin-bottom:20px}

/* PROFILE CARD */
.card{background:white;padding:20px;margin-bottom:20px;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.08)}
input{width:100%;padding:12px;border-radius:8px;border:1px solid #cbd5e1;margin-bottom:12px}
.btn{padding:10px 14px;border:none;border-radius:8px;background:#2563eb;color:white;cursor:pointer;font-weight:600}
.btn:hover{background:#1e40af}
.profile-pic{width:90px;height:90px;border-radius:50%;background:#e2e8f0;display:flex;align-items:center;justify-content:center;font-size:38px;margin-bottom:12px}
.small{color:#64748b}
</style>
</head>
<body>

<div class="sidebar">
  <h2>OSN Coach</h2>
  <a href="coach-dashboard.html">üè† Dashboard</a>
  <a href="coach-team.html">üë• Team</a>
  <a href="coach-training.html">üí™ Training</a>
  <a href="coach-matches.html">üèÜ Matches</a>
  <a href="coach-analytics.html">üìä Analytics</a>
  <a href="coach-profile.html">üôç Profile</a>
  <a href="#" onclick="logout()">üö™ Logout</a>
</div>

<div class="main">
  <div class="topbar">My Profile</div>

  <div class="card">
    <div class="profile-pic" id="pfp">üôÇ</div>
    <h3 id="uname">Coach Name</h3>
    <div class="small" id="uemail">coach@example.com</div>
    <hr style="margin:16px 0;border:0;border-bottom:1px solid #e2e8f0;">
    <h3>Update Info</h3>
    <input id="name" placeholder="Your Name">
    <input id="email" placeholder="Email Address">
    <input id="phone" placeholder="Phone Number">
    <input id="city" placeholder="City">
    <input id="age" placeholder="Age">
    <button class="btn" onclick="updateProfile()">Update Profile</button>
    <div id="msg" class="small" style="margin-top:8px"></div>
  </div>

  <div class="card">
    <h3>Change Password</h3>
    <input id="pass1" type="password" placeholder="New Password">
    <input id="pass2" type="password" placeholder="Confirm Password">
    <button class="btn" onclick="changePassword()">Update Password</button>
    <div id="msg2" class="small" style="margin-top:8px"></div>
  </div>
</div>

<script>
const token = localStorage.getItem("osn_token");
const coach = JSON.parse(localStorage.getItem("osn_user") || "{}");

if(!token || coach.role !== "coach"){
    window.location.href="../index.html";
}

document.getElementById("uname").innerText = coach.name;
document.getElementById("uemail").innerText = coach.email;
document.getElementById("name").value  = coach.name;
document.getElementById("email").value = coach.email;
document.getElementById("phone").value = coach.phone || "";
document.getElementById("city").value  = coach.city || "";
document.getElementById("age").value   = coach.age || "";

// UPDATE PROFILE
async function updateProfile(){
    let name  = document.getElementById("name").value.trim();
    let email = document.getElementById("email").value.trim();
    let phone = document.getElementById("phone").value.trim();
    let city  = document.getElementById("city").value.trim();
    let age   = document.getElementById("age").value.trim();

    let res = await fetch("/api/coach/update/" + coach.id, {
        method:"PUT",
        headers:{ "Content-Type":"application/json" },
        body:JSON.stringify({ name,email,phone,city,age })
    });

    let data = await res.json();
    const msg = document.getElementById("msg");
    if(res.ok){
        msg.innerText = "Profile Updated ‚úî";
        coach.name = name;
        coach.email = email;
        coach.phone = phone;
        coach.city = city;
        coach.age = age;
        localStorage.setItem("osn_user", JSON.stringify(coach));
        document.getElementById("uname").innerText = name;
        document.getElementById("uemail").innerText = email;
    } else {
        msg.innerText = data.message || "Error updating profile.";
    }
}

// CHANGE PASSWORD
async function changePassword(){
    let p1 = document.getElementById("pass1").value;
    let p2 = document.getElementById("pass2").value;
    const msg2 = document.getElementById("msg2");
    if(p1 !== p2){ msg2.innerText="Passwords do not match!"; return; }
    let res = await fetch("/api/coach/password/" + coach.id, {
        method:"PUT",
        headers:{ "Content-Type":"application/json" },
        body:JSON.stringify({ password:p1 })
    });
    let data = await res.json();
    if(res.ok){
        msg2.innerText = "Password Updated ‚úî";
        document.getElementById("pass1").value="";
        document.getElementById("pass2").value="";
    } else {
        msg2.innerText = data.message || "Error updating password.";
    }
}

function logout(){
    localStorage.removeItem("osn_token");
    localStorage.removeItem("osn_user");
    window.location.href="../index.html";
}
</script>

</body>
</html>
