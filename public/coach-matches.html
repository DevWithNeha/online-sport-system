<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>OSN ‚Äì Coach Matches</title>
<style>
body{margin:0;font-family:"Segoe UI",Arial;background:#f4f7fa;display:flex}
/* SIDEBAR */
.sidebar{width:230px;height:100vh;background:#1e293b;color:white;position:fixed;top:0;left:0;padding:20px 0}
.sidebar h2{text-align:center;margin-bottom:20px}
.sidebar a{display:block;padding:12px 20px;color:#cbd5e1;text-decoration:none}
.sidebar a:hover{background:#0f172a;color:white}

/* MAIN */
.main{margin-left:230px;padding:22px;width:100%}
.topbar{background:white;padding:16px;border-radius:10px;font-size:22px;font-weight:600;box-shadow:0 4px 20px rgba(0,0,0,0.08);margin-bottom:20px}

/* MATCH CARD */
.card{background:white;padding:20px;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.08);margin-bottom:20px}
.match-item{padding:12px 0;border-bottom:1px solid #eee}
.match-item:last-child{border-bottom:none}
.small{color:#64748b;font-size:13px}
input,select{padding:10px;border-radius:8px;border:1px solid #e2e8f0;margin-bottom:12px;width:100%}
.btn{padding:6px 10px;border:none;border-radius:6px;background:#2563eb;color:white;font-weight:600;cursor:pointer;margin-top:6px}
.btn:hover{background:#1e40af}
.btn.remove{background:#ef4444}
.btn.remove:hover{background:#b91c1c}
</style>
</head>
<body>

<div class="sidebar">
  <h2>OSN Coach</h2>
  <a href="coach-dashboard.html">üè† Dashboard</a>
  <a href="coach-team.html">üë• Team</a>
  <a href="coach-training.html">üí™ Training</a>
  <a href="coach-matches.html">üèÜ Matches</a>
  <a href="coach-analytics.html">üìä Analytics</a>
  <a href="coach-profile.html">üôç Profile</a>
  <a href="#" onclick="logout()">üö™ Logout</a>
</div>

<div class="main">
  <div class="topbar">Manage Matches</div>

  <div class="card">
    <h3>Add New Match</h3>
    <input id="tournament" placeholder="Tournament Name">
    <input id="teamA" placeholder="Team A">
    <input id="teamB" placeholder="Team B">
    <input id="date" type="date">
    <input id="scoreA" placeholder="Score A">
    <input id="scoreB" placeholder="Score B">
    <select id="status">
      <option value="upcoming">Upcoming</option>
      <option value="live">Live</option>
      <option value="completed">Completed</option>
    </select>
    <button class="btn" onclick="addMatch()">Add Match</button>
    <div id="msg" class="small" style="margin-top:8px"></div>
  </div>

  <div class="card">
    <h3>All Matches</h3>
    <div id="matchList">Loading matches...</div>
  </div>
</div>

<script>
const token = localStorage.getItem("osn_token");
const coach = JSON.parse(localStorage.getItem("osn_user") || "{}");

if(!token || coach.role !== "coach"){
    window.location.href="../index.html";
}

// Load matches
async function loadMatches(){
    const box = document.getElementById("matchList");
    box.innerHTML = "Loading...";
    try{
        const res = await fetch("/api/coach/matches/" + coach.id, {headers:{Authorization:"Bearer "+token}});
        const data = await res.json();
        if(!data || data.length===0){
            box.innerHTML = "<div class='small'>No matches yet.</div>";
            return;
        }
        box.innerHTML = data.map(m=>`
            <div class="match-item">
                <b>${m.tournament}</b> ‚Äî ${m.team_a} vs ${m.team_b} ‚Äî ${m.date} ‚Äî ${m.score_a||"-"}-${m.score_b||"-"} 
                <span class="small">(${m.status})</span>
                <button class="btn remove" onclick="removeMatch(${m.id})">Remove</button>
            </div>
        `).join("");
    }catch(err){
        console.error(err);
        box.innerHTML = "<div class='small'>Error loading matches.</div>";
    }
}

// Add match
async function addMatch(){
    const tournament = document.getElementById("tournament").value.trim();
    const teamA = document.getElementById("teamA").value.trim();
    const teamB = document.getElementById("teamB").value.trim();
    const date = document.getElementById("date").value;
    const scoreA = document.getElementById("scoreA").value;
    const scoreB = document.getElementById("scoreB").value;
    const status = document.getElementById("status").value;
    const msg = document.getElementById("msg");
    msg.innerText="";
    if(!tournament||!teamA||!teamB||!date){ msg.innerText="Fill required fields."; return; }

    try{
        const res = await fetch("/api/coach/match/add",{
            method:"POST",
            headers:{ "Content-Type":"application/json", Authorization:"Bearer "+token },
            body:JSON.stringify({coach_id:coach.id,tournament,team_a:teamA,team_b:teamB,date,score_a:scoreA,score_b:scoreB,status})
        });
        const data = await res.json();
        if(res.ok){
            msg.innerText="Match added ‚úî";
            document.getElementById("tournament").value="";
            document.getElementById("teamA").value="";
            document.getElementById("teamB").value="";
            document.getElementById("date").value="";
            document.getElementById("scoreA").value="";
            document.getElementById("scoreB").value="";
            loadMatches();
        } else msg.innerText = data.message||"Error adding match";
    }catch(err){
        console.error(err);
        msg.innerText="Server error";
    }
}

// Remove match
async function removeMatch(id){
    if(!confirm("Remove this match?")) return;
    try{
        const res = await fetch("/api/coach/match/remove",{
            method:"POST",
            headers:{ "Content-Type":"application/json", Authorization:"Bearer "+token },
            body:JSON.stringify({id})
        });
        if(res.ok){ loadMatches(); alert("Match removed."); }
        else { const d=await res.json(); alert(d.message||"Error"); }
    }catch(err){ console.error(err); alert("Server error"); }
}

function logout(){
    localStorage.removeItem("osn_token");
    localStorage.removeItem("osn_user");
    window.location.href="../index.html";
}

// Init
loadMatches();
</script>

</body>
</html>
